

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>dnppy.tsa.time_series &mdash; dnppy 1.15.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="dnppy 1.15.2 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> dnppy</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Purpose and Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../overview.html#scope">Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../overview.html#structure">Structure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#how-to-install">How to Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#included-packages">Included Packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../design.html">Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../design.html#modules">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../design.html#functional-format">Functional Format</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modulesum.html">Exploring the modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modulesum.html#module-summary">Module Summary</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/convert.html">convert</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/convert.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/convert.html#code-help">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/core.html">core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/core.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/core.html#code-help">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/download.html">download</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/download.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/download.html#code-help">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/landsat.html">landsat</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/landsat.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/landsat.html#code-help">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/modis.html">modis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/modis.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/modis.html#code-help">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/radar.html">radar</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/radar.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/radar.html#module-dnppy.radar.create_header">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/raster.html">raster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/raster.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/raster.html#module-dnppy.raster.apply_linear_correction">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/solar.html">solar</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/solar.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/solar.html#code-help">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/textio.html">textio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/textio.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/textio.html#module-dnppy.textio.read_DS3505">Code Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/tsa.html">tsa</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/tsa.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/tsa.html#code-help">Code Help</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_pages/development.html">Developers Starter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/development.html#contributing-through-github">Contributing Through GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/development.html#integrated-development-environment">Integrated Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/development.html#stylistic-coding-conventions">Stylistic Coding Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_pages/dev_goals.html">Future Development Goals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/dev_goals.html#dump-arcpy">Dump arcpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/dev_goals.html#python-3">Python 3</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_pages/gdal_tips.html">Intro to gdal</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/gdal_tips.html#gdal-with-dnppy">gdal with dnppy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/gdal_tips.html#using-the-osr-to-manage-projections">Using the osr to manage projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/gdal_tips.html#geotransforms">Geotransforms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_pages/contrib_git.html">GitHub Best Practices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/contrib_git.html#what-to-include-in-a-git-repo">What to include in a Git repo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/contrib_git.html#committing-to-the-master-branch">Committing to the <code class="docutils literal"><span class="pre">master</span></code> branch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/contrib_git.html#versioning">Versioning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_pages/doc.html">Building Docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/doc.html#documenting-new-additions">Documenting new additions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/doc.html#checking-the-docs">Checking the docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dev_pages/doc.html#building-the-docs">Building the docs</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Help and Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../trub/git.html">GitHub Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trub/pythonstarter.html">Python Quick-Starter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../trub/pythonstarter.html#the-right-mindset">The right mindset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../trub/pythonstarter.html#frequent-pitfalls">Frequent Pitfalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../trub/pythonstarter.html#python-terminology">Python Terminology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../trub/faq.html">Frequently Asked Questions</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">dnppy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>dnppy.tsa.time_series</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for dnppy.tsa.time_series</h1><div class="highlight"><pre>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Jwely&quot;</span>

<span class="c"># local imports</span>
<span class="kn">from</span> <span class="nn">dnppy</span> <span class="kn">import</span> <span class="n">textio</span>

<span class="c"># standard imports</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">calendar</span> <span class="kn">import</span> <span class="n">monthrange</span><span class="p">,</span> <span class="n">isleap</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="kn">as</span> <span class="nn">mdates</span>


<div class="viewcode-block" id="time_series"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series">[docs]</a><span class="k">class</span> <span class="nc">time_series</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subsettable time series object</span>

<span class="sd">    The primary motivation for creating this object was to allow</span>
<span class="sd">    a time series to be subsetted into any number of small chunks</span>
<span class="sd">    but retain the ability to process and interrogate the time series</span>
<span class="sd">    at any level with the exact same external syntax.</span>

<span class="sd">    A time series object is comprised of a matrix of data, and may contain</span>
<span class="sd">    an object list of subset time_series objects. Potentially unlimited</span>
<span class="sd">    nesting of time series datasets is possible, for example: a years worth</span>
<span class="sd">    of hourly data may be subsetted into 1-month time series, while each</span>
<span class="sd">    of those is in turn subsetted into days. The highest level time series</span>
<span class="sd">    will still allow opperations to be performed upon it.</span>

<span class="sd">    All internal methods are built to handle this flexible definition of a</span>
<span class="sd">    time series, where the steps of the method depend on weather the time</span>
<span class="sd">    series is at its smallest subset or not.</span>

<span class="sd">    MEMORY WARNING. The entirety of the dataset is represented in every layer</span>
<span class="sd">    of subsetting, so watch out for exploding memory consumption by</span>
<span class="sd">    excessive subsetting of gigantic datasets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subsetted</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                 <span class="n">disc_level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the time series</span>

<span class="sd">        Attributes:</span>
<span class="sd">            self.name           # the name of this time series</span>
<span class="sd">            self.units          # unit of time represented by subset if subsetted</span>
<span class="sd">            self.subsetted      # does this time series have subsets?</span>
<span class="sd">            self.disc_level     # the subset level of this time_series</span>

<span class="sd">            self.fmt            # for interpreting timestrings to time objs</span>
<span class="sd">            self.headers        # one header for each col in dataset</span>

<span class="sd">            self.time_col       # index of data column with time info</span>
<span class="sd">            self.time           # separate copy of data[time_col]</span>
<span class="sd">            self.time_dom       # self.time converted to list of datetime objs</span>
<span class="sd">            self.time_dec_days  # self.time converted to mono rising decimal days</span>
<span class="sd">            self.time_seconds   # self.time converted to mono rising seconds</span>
<span class="sd">            self.center_time    # time around which data in a subset it centered</span>
<span class="sd">            self.start_dto      # datetime_object that mono rising times start from</span>

<span class="sd">            self.subsets        # object list containing constituent time_seires</span>

<span class="sd">            self.row_data       # row wise dataset</span>
<span class="sd">            self.col_data       # column wise dataset, built as dict</span>

<span class="sd">            self.bad_rows       # subset from data attribute with &quot;bad rows&quot;</span>

<span class="sd">            self.infilepath     # tracks filepath of input CSV. used to DISALLOW overwriting</span>
<span class="sd">                                # source CSV with output CSV.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>           <span class="o">=</span> <span class="n">name</span>        <span class="c"># the name of this time series (string)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span>          <span class="o">=</span> <span class="n">units</span>       <span class="c"># unit of time represented by subset if subsetted (string)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span>      <span class="o">=</span> <span class="n">subsetted</span>   <span class="c"># does this time series have subsets? (bool)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disc_level</span>     <span class="o">=</span> <span class="n">disc_level</span>  <span class="c"># the subset level of this time_series (int)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span>            <span class="o">=</span> <span class="bp">False</span>       <span class="c"># for interpreting timestrings to time objs (string)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>        <span class="o">=</span> <span class="p">[]</span>          <span class="c"># one header for each col in dataset (list of strings)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_col</span>       <span class="o">=</span> <span class="mi">0</span>           <span class="c"># index of data column with time info (int)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span>           <span class="o">=</span> <span class="p">[]</span>          <span class="c"># separate copy of data[time_col] (list of strings)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span>       <span class="o">=</span> <span class="bp">False</span>       <span class="c"># self.time converted to (list of datetime objs)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_dec_days</span>  <span class="o">=</span> <span class="p">[]</span>          <span class="c"># self.time converted to (mono rising decimal days floats)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_seconds</span>   <span class="o">=</span> <span class="p">[]</span>          <span class="c"># self.time converted to (mono rising seconds floats)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_time</span>    <span class="o">=</span> <span class="p">[]</span>          <span class="c"># time around which data in a subset it centered (dto)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_dto</span>      <span class="o">=</span> <span class="p">[]</span>          <span class="c"># datetime_object that mono rising times start from (dto)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_interval</span>  <span class="o">=</span> <span class="mi">0</span>           <span class="c"># average number of seconds between data points (float)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span>        <span class="o">=</span> <span class="p">[]</span>          <span class="c"># object list containing constituent time_series</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span>       <span class="o">=</span> <span class="p">[]</span>          <span class="c"># row wise dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span>       <span class="o">=</span> <span class="p">[]</span>          <span class="c"># column wise dataset, built as dict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bad_rows</span>       <span class="o">=</span> <span class="p">[]</span>          <span class="c"># subset from data attribute with &quot;bad rows&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">infilepath</span>     <span class="o">=</span> <span class="p">[]</span>          <span class="c"># tracks filepath of input CSV. used to DISALLOW overwriting</span>
                                          <span class="c"># source CSV with output CSV.</span>
        
        <span class="c"># run some methods to build subset attributes</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_atts_from</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            
        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        allows subsets of the time series to be accessed as follows, for example:</span>

<span class="sd">        Time series whos first row is:</span>
<span class="sd">        [&#39;20010101&#39;, &#39;045316&#39;, &#39;1&#39;, &#39;20010101045316&#39;, 366]</span>

<span class="sd">        With no discretization layers</span>
<span class="sd">        command       : result</span>
<span class="sd">        ts[0]         : [&#39;20010101&#39;, &#39;045316&#39;, &#39;1&#39;, &#39;20010101045316&#39;, 366]</span>
<span class="sd">        ts[0][0]      : 20010101</span>

<span class="sd">        with one discretization layer</span>
<span class="sd">        ts[0]         : &lt;__main__.time_series instance at 0x00000000023CEB48&gt;</span>
<span class="sd">        ts[0][0]      : [&#39;20010101&#39;, &#39;045316&#39;, &#39;1&#39;, &#39;20010101045316&#39;, 366]</span>
<span class="sd">        ts[0][0][0]   : 20010101</span>

<span class="sd">        with two discretization layers</span>
<span class="sd">        ts[0]         : &lt;__main__.time_series instance at 0x00000000023CEB48&gt;</span>
<span class="sd">        ts[0][0]      : &lt;__main__.time_series instance at 0x00000000023CCA48&gt;</span>
<span class="sd">        ts[0][0][0]   : [&#39;20010101&#39;, &#39;045316&#39;, &#39;1&#39;, &#39;20010101045316&#39;, 366]</span>
<span class="sd">        ts[0][0][0][0]: 20010101</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># allows finding a slice of subsets or rows from a subset.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">start</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">stop</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">):</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">):</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span>

        <span class="c"># allows finding subsets or rows by index.</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>

        <span class="c"># allows finding subsets by name.</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">subset</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">arg</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">subset</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;no subset with name {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;String input is allowed for subsetted time_series only!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Unrecognized argument type! use int, slice, or string!&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="time_series._get_atts_from"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._get_atts_from">[docs]</a>    <span class="k">def</span> <span class="nf">_get_atts_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_time_series</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows bulk setting of attributes. Useful for allowing a subset to inherit</span>
<span class="sd">        information from its parent time_series</span>

<span class="sd">        :param parent_time_series:  a time_series object from which to inherit</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span>            <span class="o">=</span> <span class="n">parent_time_series</span><span class="o">.</span><span class="n">fmt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>        <span class="o">=</span> <span class="n">parent_time_series</span><span class="o">.</span><span class="n">headers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_col</span>       <span class="o">=</span> <span class="n">parent_time_series</span><span class="o">.</span><span class="n">time_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_header</span>    <span class="o">=</span> <span class="n">parent_time_series</span><span class="o">.</span><span class="n">time_header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disc_level</span>     <span class="o">=</span> <span class="n">parent_time_series</span><span class="o">.</span><span class="n">disc_level</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span>

</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="time_series._fmt_to_units"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._fmt_to_units">[docs]</a>    <span class="k">def</span> <span class="nf">_fmt_to_units</span><span class="p">(</span><span class="n">in_fmt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts fmt strings to unit names of associated datetime attributes</span>

<span class="sd">        :param fmt:    datetime object style unit characters like %Y or %m</span>
<span class="sd">        :return units: english version of input format. Example %Y -&gt; &quot;year&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fmtlist</span> <span class="o">=</span>  <span class="p">[</span><span class="s">&quot;%Y&quot;</span><span class="p">,</span> <span class="s">&quot;%m&quot;</span><span class="p">,</span> <span class="s">&quot;%b&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;%j&quot;</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">]</span>
        <span class="n">unitlist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;year&quot;</span><span class="p">,</span><span class="s">&quot;month&quot;</span><span class="p">,</span><span class="s">&quot;month&quot;</span><span class="p">,</span><span class="s">&quot;day&quot;</span><span class="p">,</span><span class="s">&quot;day&quot;</span><span class="p">,</span><span class="s">&quot;hour&quot;</span><span class="p">,</span><span class="s">&quot;minute&quot;</span><span class="p">,</span><span class="s">&quot;second&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">in_fmt</span> <span class="ow">in</span> <span class="n">fmtlist</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">unitlist</span><span class="p">[</span><span class="n">fmtlist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">in_fmt</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">unit</span>

        <span class="k">if</span> <span class="n">in_fmt</span> <span class="ow">in</span> <span class="n">unitlist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">in_fmt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;&#39;{0}&#39; is an invalid unit or format!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">in_fmt</span><span class="p">))</span>

</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="time_series._units_to_fmt"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._units_to_fmt">[docs]</a>    <span class="k">def</span> <span class="nf">_units_to_fmt</span><span class="p">(</span><span class="n">units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts unit names to fmt strings used by datetime.stftime.</span>

<span class="sd">        :param units:   units are strings like &quot;year&quot;, &quot;month&quot;, &quot;hour&quot;</span>
<span class="sd">        :return fmt:    returns &quot;fmt&quot; equivalent of english units</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fmtlist</span> <span class="o">=</span>  <span class="p">[</span><span class="s">&quot;%Y&quot;</span><span class="p">,</span> <span class="s">&quot;%b&quot;</span><span class="p">,</span> <span class="s">&quot;%m&quot;</span><span class="p">,</span> <span class="s">&quot;%j&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;%H&quot;</span><span class="p">,</span> <span class="s">&quot;%M&quot;</span><span class="p">,</span> <span class="s">&quot;%S&quot;</span><span class="p">]</span>
        <span class="n">unitlist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;year&quot;</span><span class="p">,</span><span class="s">&quot;month&quot;</span><span class="p">,</span><span class="s">&quot;month&quot;</span><span class="p">,</span><span class="s">&quot;day&quot;</span><span class="p">,</span><span class="s">&quot;day&quot;</span><span class="p">,</span><span class="s">&quot;hour&quot;</span><span class="p">,</span><span class="s">&quot;minute&quot;</span><span class="p">,</span><span class="s">&quot;second&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">unitlist</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmtlist</span><span class="p">[</span><span class="n">unitlist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">units</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">fmt</span>
        
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;%b&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;%m&quot;</span>
        
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">fmtlist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">units</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;&#39;{0}&#39; is an invalid unit or format!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="time_series._extract_time"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._extract_time">[docs]</a>    <span class="k">def</span> <span class="nf">_extract_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  special case of &quot;extract_column&quot; method for time domain. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_header</span> <span class="o">=</span> <span class="n">time_header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_col_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">time_header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_col</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">time_header</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">time_header</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="s">&quot;Time header not in dataset!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">_extract_time</span><span class="p">(</span><span class="n">time_header</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="time_series._center_datetime"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._center_datetime">[docs]</a>    <span class="k">def</span> <span class="nf">_center_datetime</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns datetime obj that is centered on the &quot;unit&quot; of the input datetime obj</span>

<span class="sd">        When grouping datetimes together, center times are important. This function allows</span>
<span class="sd">        a center time with units equal to the users input (years, months, days , ...) to be</span>
<span class="sd">        generated from the first datetime of the time series.</span>

<span class="sd">        :param datetime_obj:     any datetime object</span>
<span class="sd">        :param units:            units by which to center input datetime object</span>
<span class="sd">        :return center_datetime: returns centered datetime object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dto</span> <span class="o">=</span> <span class="n">datetime_obj</span>
        
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;day&quot;</span><span class="p">:</span>
            <span class="c"># noon minus 1 millisecond. (better handles daily data with no hour info)</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">dto</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dto</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dto</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;month&quot;</span><span class="p">:</span>
            <span class="c"># we need to find the middle day of the month which could be 14 or 15</span>
            <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">monthrange</span><span class="p">(</span><span class="n">dto</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dto</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">dto</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dto</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;year&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">dto</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="time_series._units_to_seconds"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._units_to_seconds">[docs]</a>    <span class="k">def</span> <span class="nf">_units_to_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">dto</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts other time units to seconds</span>

<span class="sd">        :param units:       some english unit such as &quot;hour&quot;, &quot;day&quot;, etc.</span>
<span class="sd">        :return seconds:    the numer of seconds in an input unit</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># ensure proper unit formatting</span>
        <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_to_units</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;second&quot;</span><span class="p">:</span>   <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;minute&quot;</span><span class="p">:</span>   <span class="k">return</span> <span class="mf">60.0</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;hour&quot;</span><span class="p">:</span>     <span class="k">return</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;day&quot;</span><span class="p">:</span>      <span class="k">return</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">24.0</span>
        
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;month&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dto</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="n">monthrange</span><span class="p">(</span><span class="n">dto</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dto</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">365.25</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;year&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dto</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">365</span> <span class="o">+</span> <span class="n">isleap</span><span class="p">(</span><span class="n">dto</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">*</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="mf">365.25</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="time_series._seconds_to_units"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._seconds_to_units">[docs]</a>    <span class="k">def</span> <span class="nf">_seconds_to_units</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts seconds to other time units</span>

<span class="sd">        :param seconds:  number of seconds</span>
<span class="sd">        :param units:    units to convert those seconds to</span>

<span class="sd">        :return: time equivalent of input seconds expressed as input units</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;second&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;minute&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">seconds</span> <span class="o">/</span> <span class="mf">60.0</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;hour&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;day&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">24.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;month&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">365.25</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s">&quot;year&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mf">60.0</span> <span class="o">*</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="mf">365.25</span><span class="p">)</span>

    </div>
<div class="viewcode-block" id="time_series._name_as_subset"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._name_as_subset">[docs]</a>    <span class="k">def</span> <span class="nf">_name_as_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binned</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        uses time series object to descriptively name itself. Naming</span>
<span class="sd">        subsets as bins will name them based only on smallest unit of</span>
<span class="sd">        discretization.</span>

<span class="sd">        :param binned:  set to True to name subsets as bins</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">subset_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_time</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">datetime_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datetime_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">binned</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">datetime_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units_to_fmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;year&quot;</span> <span class="ow">or</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;%Y&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">datetime_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;month&quot;</span> <span class="ow">or</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;%m&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">datetime_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%b&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;day&quot;</span> <span class="ow">or</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">datetime_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;hour&quot;</span> <span class="ow">or</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;%H&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">datetime_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">-%H&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;minute&quot;</span> <span class="ow">or</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;%M&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">datetime_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">-%H:%M&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;second&quot;</span> <span class="ow">or</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;%S&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">datetime_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">-%H:%M:%S&quot;</span><span class="p">)</span>

        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.rename_header"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.rename_header">[docs]</a>    <span class="k">def</span> <span class="nf">rename_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_name</span><span class="p">,</span> <span class="n">new_header_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        renames a header and updates data structures</span>

<span class="sd">        :param header_name:     name of an existing header</span>
<span class="sd">        :param new_header_name: new name of that header</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">header_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">header_name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">new_header_name</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">new_header_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">header_name</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">header_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">rename_header</span><span class="p">(</span><span class="n">header_name</span><span class="p">,</span> <span class="n">new_header_name</span><span class="p">)</span>
            
        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.from_tdo"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.from_tdo">[docs]</a>    <span class="k">def</span> <span class="nf">from_tdo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tdo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads time series data from a dnppy.text_data_class object</span>

<span class="sd">        :param tdo:     a dnppy.text_data_class object containing time data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>  <span class="o">=</span> <span class="n">tdo</span><span class="o">.</span><span class="n">headers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enf_unique_headers</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="n">tdo</span><span class="o">.</span><span class="n">row_data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">build_col_data</span><span class="p">()</span>
        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.from_csv"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.from_csv">[docs]</a>    <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">delim</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple reader of a delimited file. To read more complex text data</span>
<span class="sd">        into a time series object, use a custom reader function to return</span>
<span class="sd">        a text_data_class object and feed it into this time series with</span>

<span class="sd">        time_series_object.from_tdo(text_data_object)</span>

<span class="sd">        To read csvs straight to a time_series object, it must have headers.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tdo</span> <span class="o">=</span> <span class="n">textio</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">delim</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">from_tdo</span><span class="p">(</span><span class="n">tdo</span><span class="p">)</span>

        <span class="k">return</span>

 </div>
<div class="viewcode-block" id="time_series.to_csv"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.to_csv">[docs]</a>    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the row data of this time_series to a csv file.</span>

<span class="sd">        :param csv_path: filepath at which to create new csv file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># disallow overwriting the csv used as input. Added by request</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infilepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">csv_path</span><span class="p">):</span>
            <span class="n">csv_path</span> <span class="o">=</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;.csv&quot;</span><span class="p">,</span> <span class="s">&quot;_out.csv&quot;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Saved time series &#39;{0}&#39; with {1} rows and {2} columns&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">)))</span>

        <span class="n">tdo</span> <span class="o">=</span> <span class="n">textio</span><span class="o">.</span><span class="n">text_data</span><span class="p">(</span> <span class="n">text_filepath</span>   <span class="o">=</span> <span class="n">csv_path</span><span class="p">,</span>
                                <span class="n">headers</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
                                <span class="n">row_data</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">)</span>

        <span class="n">tdo</span><span class="o">.</span><span class="n">write_csv</span><span class="p">()</span>
        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.from_list"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.from_list">[docs]</a>    <span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">time_header</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creates the time series data from a list</span>

<span class="sd">        :param data:            list of lists making up rows and columns of data</span>
<span class="sd">        :param headers:         list of headers (column names)</span>
<span class="sd">        :param time_header:     string of header over the column representing time</span>
<span class="sd">        :param fmt:             the format of data in that time column</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span>  <span class="o">=</span> <span class="n">headers</span>

        <span class="c"># populates self.time with time series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_col_data</span><span class="p">()</span>
        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.build_col_data"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.build_col_data">[docs]</a>    <span class="k">def</span> <span class="nf">build_col_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; builds columnwise data matrix with an actual dict &quot;&quot;&quot;</span>

        <span class="n">temp_col</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temp_col</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.clean"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_header</span><span class="p">,</span> <span class="n">high_thresh</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">low_thresh</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes rows where the specified column has an invalid number</span>
<span class="sd">        or is outside the defined thresholds (above high_thresh or below low_thresh)</span>

<span class="sd">        :param col_header:  name of column to clean</span>
<span class="sd">        :param high_thresh: maximum valid value of data in that column</span>
<span class="sd">        :param low_thresh:  minimum valid value of data in that column</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c"># loop cleaning for multiple column header inputs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_header</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col_head</span> <span class="ow">in</span> <span class="n">col_header</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">col_head</span><span class="p">)</span>
                
        <span class="c"># clean for just one input column header</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">col_header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="s">&quot;{0} header not in dataset!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">))</span>

            <span class="n">col_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>
            <span class="n">temp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">bad_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">temp_data</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">test</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col_index</span><span class="p">])</span>
                    
                    <span class="k">if</span>   <span class="n">high_thresh</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">low_thresh</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">high_thresh</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">low_thresh</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">test</span> <span class="o">&gt;=</span> <span class="n">low_thresh</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">high_thresh</span> <span class="o">!=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">low_thresh</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">test</span> <span class="o">&lt;=</span> <span class="n">high_thresh</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">high_thresh</span> <span class="o">!=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">low_thresh</span> <span class="o">!=</span> <span class="bp">False</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">test</span> <span class="o">&gt;=</span> <span class="n">low_thresh</span> <span class="ow">and</span> <span class="n">test</span> <span class="o">&lt;=</span> <span class="n">high_thresh</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                            
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">bad_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bad_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="n">bad_count</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Removed {0} rows from &#39;{1}&#39; with invalid &#39;{2}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">bad_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">col_header</span><span class="p">))</span>
                

            <span class="c"># since rows have been removed, we must redefine the time domain. (sloppy, but concise)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_dto</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                    <span class="n">subset</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>
        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.rebuild"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.rebuild">[docs]</a>    <span class="k">def</span> <span class="nf">rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destroy_subsets</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reconstructs the time series from its constituent subsets</span>

<span class="sd">        :param destroy_subsets: Set to TRUE to destroy the existing subsets</span>
<span class="sd">                                of the time series, which will allow them to</span>
<span class="sd">                                rebuilt in a different manner.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># handles time series with multiple levels of discretezation</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">rebuild</span><span class="p">(</span><span class="n">destroy_subsets</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">row_data</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">define_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">destroy_subsets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.merge_cols"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.merge_cols">[docs]</a>    <span class="k">def</span> <span class="nf">merge_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header1</span><span class="p">,</span> <span class="n">header2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        merges two columns together (string concatenation) into a new column.</span>
<span class="sd">        The new column will be named [header1]_[header2].</span>

<span class="sd">        :param header1: the name of the 1st column to merge</span>
<span class="sd">        :param header2: the name of the 2nd column to merge</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_header</span>  <span class="o">=</span> <span class="s">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">header1</span><span class="p">,</span> <span class="n">header2</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">):</span>
                <span class="n">new_field</span>   <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">header1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">header2</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_field</span><span class="p">)</span>

        <span class="c"># updates column and row data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_header</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_col_data</span><span class="p">()</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;merged &#39;{0}&#39; and &#39;{1}&#39; columns into new column &#39;{2}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header1</span><span class="p">,</span> <span class="n">header2</span><span class="p">,</span> <span class="n">new_header</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">merge_cols</span><span class="p">(</span><span class="n">header1</span><span class="p">,</span> <span class="n">header2</span><span class="p">)</span>
        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series._build_time"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series._build_time">[docs]</a>    <span class="k">def</span> <span class="nf">_build_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_header</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">start_date</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This internal use function is called twice by &quot;define_time&quot;. Once to turn</span>
<span class="sd">        all the datestamps into datetime objects, then a second time once the entire</span>
<span class="sd">        dataset has been sorted in ascending time order by those datetime objects.</span>

<span class="sd">        This is to ensure all time values are in terms of the correct start time,</span>
<span class="sd">        which can be no later than the earliest entry in the dataset.</span>

<span class="sd">        :param time_header: name of column with time data in it</span>
<span class="sd">        :param fmt:         the fmt string to interpret time data into datetime objects</span>
<span class="sd">        :param start_date:  The date to count up from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># set format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span>            <span class="o">=</span> <span class="n">fmt</span>

        <span class="c"># extract time column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_time</span><span class="p">(</span><span class="n">time_header</span><span class="p">)</span>

        <span class="c"># allows column index integers as time_header inputs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_header</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">time_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">time_header</span><span class="p">]</span>

        <span class="c"># use manual start date (str or dto) or set to begining of first day on record</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start_date</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">earliest</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">earliest</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">earliest</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">earliest</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># convert datestamps into datetime objects</span>
        <span class="n">datestamp_list</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span>       <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_dec_days</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_seconds</span>   <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">datestamp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datestamp_list</span><span class="p">):</span>

            <span class="c"># If error, give user information about the line on which the error occurs</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datestamp</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Input &#39;{0}&#39; in line {1} is not of format {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">datestamp</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span> <span class="p">,</span> <span class="n">fmt</span><span class="p">))</span>
            
            <span class="c"># initial absolute time ordering to help with sorting.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">start</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_seconds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_dec_days</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_dto</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">return</span>

        </div>
<div class="viewcode-block" id="time_series.define_time"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.define_time">[docs]</a>    <span class="k">def</span> <span class="nf">define_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_header</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">start_date</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts time strings into time objects for standardized processing. For tips</span>
<span class="sd">        on how to use &#39;fmt&#39; variable, see</span>
<span class="sd">        [https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior]</span>

<span class="sd">        Time header variable can be either the header string, or a column index num</span>

<span class="sd">        Creates</span>
<span class="sd">            A converted list of time objects (self.time_dom)</span>
<span class="sd">            A new list of monotonically increasing decimal days (self.time_dec_days)</span>
<span class="sd">            A new list of monotonically increasing second values (self.time_seconds)</span>

<span class="sd">        :param time_header: name of column with time data in it</span>
<span class="sd">        :param fmt:         the fmt string to interpret time data into datetime objects</span>
<span class="sd">        :param start_date:  The date to count up from.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># build time vectors for the first time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_time</span><span class="p">(</span><span class="n">time_header</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">start_date</span><span class="p">)</span>
        
        <span class="c"># sort data such that it is in ascending order by time.</span>
        <span class="n">sorted_rows</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">))</span>
        <span class="n">indices</span>     <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">))</span>
        <span class="n">indices</span>     <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_seconds</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
            <span class="n">sorted_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="n">sorted_rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_col_data</span><span class="p">()</span>
        
        <span class="c"># recalculate time domain information now that rows are in proper order</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_seconds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_time</span><span class="p">(</span><span class="n">time_header</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">start_date</span><span class="p">)</span>

        <span class="c"># calculate the mean_interval in seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_interval</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">)</span>
            
        <span class="c"># perform same operation on each subset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">define_time</span><span class="p">(</span><span class="n">time_header</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>     

        <span class="k">return</span>


        </div>
<div class="viewcode-block" id="time_series.make_subsets"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.make_subsets">[docs]</a>    <span class="k">def</span> <span class="nf">make_subsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset_units</span><span class="p">,</span> <span class="n">overlap_width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="n">cust_center_time</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">discard_old</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        splits the time series into individual time chunks</span>

<span class="sd">        used for taking advanced statistics, usually periodic</span>
<span class="sd">        in nature. Also useful for exploiting temporal relationships</span>
<span class="sd">        in a dataset for a variety of purposes including data</span>
<span class="sd">        sanitation, periodic curve fitting, etc.</span>

<span class="sd">        :param subset_units:</span>
<span class="sd">            subset_units follows convention of fmt. For example:</span>
<span class="sd">            %Y  groups files by year</span>
<span class="sd">            %m  groups files by month</span>
<span class="sd">            %j  groups file by julian day of year</span>

<span class="sd">        :param overlap_width:</span>
<span class="sd">            this variable can be set to greater than 0</span>
<span class="sd">            to allow &quot;window&quot; type statistics, so each subset may contain </span>
<span class="sd">            data points from adjacent subsets.</span>
<span class="sd">            </span>
<span class="sd">            overlap_width = 1 is like a window size of 3</span>
<span class="sd">            overlap_width = 2 is like a window size of 5</span>

<span class="sd">            WARNING: this function is imperfect for making subsets by months.</span>
<span class="sd">            the possible lengths of a month are extremely variant, so sometimes</span>
<span class="sd">            data points at the ends of a month will get placed in the adjacent</span>
<span class="sd">            month. If you absolutely require accurate month subsetting,</span>
<span class="sd">            you should use this function to subset by year, then use the</span>
<span class="sd">            &quot;group_bins&quot; function to bin each year by month. so,</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">                ts.subset(&quot;%b&quot;)     # subset by month</span>

<span class="sd">                ts.subset(&quot;%Y&quot;)     # subset by year</span>
<span class="sd">                ts.group_bins(&quot;%b&quot;) # bin by month</span>

<span class="sd">        :param cust_center_time:</span>
<span class="sd">            Allows a custom center time to be used! This was added so that</span>
<span class="sd">            days could be centered around a specific daily acquisition time.</span>
<span class="sd">            for example, its often useful to define a day as</span>
<span class="sd">            satellite data acquisition time +/- 12 hours.</span>
<span class="sd">            if used, &quot;cust_center_time&quot; must be a datetime object!</span>

<span class="sd">        :param discard_old:</span>
<span class="sd">            By default, performing a subsetting on a time series that already</span>
<span class="sd">            has subsets does not subset the master time series, but instead</span>
<span class="sd">            the lowest level subsets. Setting &quot;discard_old&quot; to &quot;True&quot; will</span>
<span class="sd">            discard all previous subsets of the time series and start subsetting</span>
<span class="sd">            from scratch.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">discard_old</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">make_subsets</span><span class="p">(</span><span class="n">subset_units</span><span class="p">,</span> <span class="n">overlap_width</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="c"># sanitize overlap</span>
            <span class="k">if</span> <span class="n">overlap_width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;overlap_width must be 0 or more, setting it to 0!&quot;</span><span class="p">)</span>
                <span class="n">overlap_width</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c"># convert units into subset units and into terms of seconds</span>
            <span class="c"># timedelta objects can only have units of days or seconds, so we use seconds</span>
            <span class="n">subset_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_to_units</span><span class="p">(</span><span class="n">subset_units</span><span class="p">)</span>

            <span class="c"># initial step width</span>
            <span class="n">step_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units_to_seconds</span><span class="p">(</span><span class="n">subset_units</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">subset_units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;year&#39;</span><span class="p">,</span><span class="s">&#39;month&#39;</span><span class="p">,</span><span class="s">&#39;day&#39;</span><span class="p">,</span><span class="s">&#39;minute&#39;</span><span class="p">]:</span>
               <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Data is too high resolution to subset by {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subset_units</span><span class="p">))</span>

            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Subsetting data by {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subset_units</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;must call &#39;define_time&#39; method before taking subsets!&quot;</span><span class="p">)</span>
            
            <span class="c"># determine subset lists starting, end points and increment</span>
            <span class="n">time_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">time_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c"># set up starttime with custom center times.</span>
            <span class="k">if</span> <span class="n">cust_center_time</span><span class="p">:</span>
                
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;using custom center time&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;month&quot;</span><span class="p">:</span>
                    <span class="n">ustart</span>  <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">time_s</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                       <span class="n">cust_center_time</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">cust_center_time</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                                       <span class="n">cust_center_time</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">cust_center_time</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
                                       <span class="n">cust_center_time</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;hour&quot;</span><span class="p">:</span>
                    <span class="n">ustart</span>  <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">time_s</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                                       <span class="n">cust_center_time</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">cust_center_time</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
                                       <span class="n">cust_center_time</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">subset_units</span> <span class="o">==</span> <span class="s">&quot;minute&quot;</span><span class="p">:</span>
                    <span class="n">ustart</span>  <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">time_s</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                                       <span class="n">cust_center_time</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">cust_center_time</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="c">#subset_units == &quot;day&quot;:</span>
                    <span class="n">ustart</span>  <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">time_s</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">time_s</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                       <span class="n">cust_center_time</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">cust_center_time</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                                       <span class="n">cust_center_time</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">cust_center_time</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>

                <span class="n">td</span>      <span class="o">=</span> <span class="n">time_f</span> <span class="o">-</span> <span class="n">time_s</span>
                <span class="n">uend</span>    <span class="o">=</span> <span class="n">cust_center_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>

            <span class="c"># otherwise, set the centers with no offset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ustart</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center_datetime</span><span class="p">(</span><span class="n">time_s</span><span class="p">,</span> <span class="n">subset_units</span><span class="p">)</span>
                <span class="n">uend</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center_datetime</span><span class="p">(</span><span class="n">time_f</span><span class="p">,</span> <span class="n">subset_units</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">step_width</span><span class="p">)</span>


            <span class="c"># Iterate through entire dataset one time step unit at a time.</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">uend</span> <span class="o">-</span> <span class="n">ustart</span>
            <span class="n">center_time</span> <span class="o">=</span> <span class="n">ustart</span>

            <span class="k">while</span> <span class="n">center_time</span> <span class="o">&lt;</span> <span class="n">uend</span><span class="p">:</span>
                
                <span class="n">step_width</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units_to_seconds</span><span class="p">(</span><span class="n">subset_units</span><span class="p">,</span> <span class="n">center_time</span><span class="p">)</span>
                <span class="n">wind_seconds</span> <span class="o">=</span> <span class="n">step_width</span> <span class="o">*</span> <span class="p">(</span><span class="n">overlap_width</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

                <span class="n">temp_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">current_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">center_time</span> <span class="o">-</span> <span class="n">current_time</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">wind_seconds</span><span class="p">:</span>
                        <span class="n">temp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                <span class="c"># create the subset only if some data was found to populate it</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">new_subset</span> <span class="o">=</span> <span class="n">time_series</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="n">subset_units</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="n">new_subset</span><span class="o">.</span><span class="n">center_time</span> <span class="o">=</span> <span class="n">center_time</span>
                    <span class="n">new_subset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">temp_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">)</span>
                    <span class="n">new_subset</span><span class="o">.</span><span class="n">define_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">)</span>
                    <span class="n">new_subset</span><span class="o">.</span><span class="n">_name_as_subset</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_subset</span><span class="p">)</span>

                <span class="n">center_time</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">step_width</span><span class="p">)</span>

        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.group_bins"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.group_bins">[docs]</a>    <span class="k">def</span> <span class="nf">group_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt_units</span><span class="p">,</span> <span class="n">overlap_width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cyclical</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the time series into time chunks by common bin_unit</span>

<span class="sd">        used for grouping data rows together. For example, if one used</span>
<span class="sd">        this function on a 5 year dataset with a bin_unit of month,</span>
<span class="sd">        then the time_series would be subseted into 12 sets (1 for each</span>
<span class="sd">        month), which each set containing all entries for that month,</span>
<span class="sd">        regardless of what year they occurred in.</span>

<span class="sd">        :param fmt_units:</span>
<span class="sd">            %Y  groups files by year</span>
<span class="sd">            %m  groups files by month</span>
<span class="sd">            %j  groups file by julian day of year</span>

<span class="sd">        :param overlap_width:</span>
<span class="sd">            similarly to &quot;make_subsets&quot; the &quot;overlap_width&quot; variable can be</span>
<span class="sd">            set to greater than 1 to allow &quot;window&quot; type statistics, so</span>
<span class="sd">            each subset may contain data points from adjacent subsets.</span>
<span class="sd">            However, for group_bins, overlap_width must be an integer.</span>

<span class="sd">        :param cyclical:</span>
<span class="sd">            &quot;cyclical&quot; of &quot;True&quot; will allow end points to be considered adjacent.</span>
<span class="sd">            So, for example, January will be considered adjacent to December,</span>
<span class="sd">            day 1 will be considered adjacent to day 365.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">overlap_width</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">group_bins</span><span class="p">(</span><span class="n">fmt_units</span><span class="p">,</span> <span class="n">overlap_width</span><span class="p">,</span> <span class="n">cyclical</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="c"># ensure proper unit format is present</span>
            <span class="n">fmt</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units_to_fmt</span><span class="p">(</span><span class="n">fmt_units</span><span class="p">)</span>
            <span class="n">units</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_to_units</span><span class="p">(</span><span class="n">fmt_units</span><span class="p">)</span>

            <span class="c"># set up cyclical parameters</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&quot;%j&quot;</span><span class="p">:</span> <span class="n">cylen</span> <span class="o">=</span> <span class="mi">365</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">:</span> <span class="n">cylen</span> <span class="o">=</span> <span class="mi">365</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&quot;%m&quot;</span><span class="p">:</span> <span class="n">cylen</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&quot;%b&quot;</span><span class="p">:</span> <span class="n">cylen</span> <span class="o">=</span> <span class="mi">12</span>

            <span class="c"># initialize a grouping array to idenfity row indices for each subset</span>
            <span class="n">grouping</span>  <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">grouping</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">grouping</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

                <span class="n">subset_units</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_to_units</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
                <span class="n">new_subset</span>      <span class="o">=</span> <span class="n">time_series</span><span class="p">(</span> <span class="n">units</span> <span class="o">=</span> <span class="n">subset_units</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>

                <span class="c"># only take rows whos grouping is within ow of i</span>
                <span class="n">subset_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grouping</span><span class="p">)</span> <span class="k">if</span> <span class="n">g</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">+</span><span class="n">ow</span> <span class="ow">and</span> <span class="n">g</span> <span class="o">&gt;=</span><span class="n">i</span><span class="o">-</span><span class="n">ow</span><span class="p">]</span>

                <span class="c"># fix endpoints</span>
                <span class="k">if</span> <span class="n">cyclical</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">ow</span><span class="p">:</span>
                        <span class="n">subset_rows</span> <span class="o">=</span> <span class="n">subset_rows</span> <span class="o">+</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grouping</span><span class="p">)</span> <span class="k">if</span> <span class="n">g</span><span class="o">-</span><span class="n">cylen</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">+</span><span class="n">ow</span> <span class="ow">and</span> <span class="n">g</span><span class="o">-</span><span class="n">cylen</span> <span class="o">&gt;=</span><span class="n">i</span><span class="o">-</span><span class="n">ow</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">cylen</span> <span class="o">-</span> <span class="n">ow</span><span class="p">:</span>
                        <span class="n">subset_rows</span> <span class="o">=</span> <span class="n">subset_rows</span> <span class="o">+</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grouping</span><span class="p">)</span> <span class="k">if</span> <span class="n">g</span><span class="o">+</span><span class="n">cylen</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">+</span><span class="n">ow</span> <span class="ow">and</span> <span class="n">g</span><span class="o">+</span><span class="n">cylen</span> <span class="o">&gt;=</span><span class="n">i</span><span class="o">-</span><span class="n">ow</span><span class="p">]</span>

                <span class="c"># grab row indeces from parent matrix to put in the subset</span>
                <span class="n">subset_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset_rows</span><span class="p">]</span>

                <span class="c"># run naming methods and definitions on the new subset</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">new_subset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">subset_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">)</span>
                    <span class="n">new_subset</span><span class="o">.</span><span class="n">define_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">)</span>
                    
                    <span class="n">new_subset</span><span class="o">.</span><span class="n">center_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">[</span><span class="n">grouping</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
                    <span class="n">new_subset</span><span class="o">.</span><span class="n">_name_as_subset</span><span class="p">(</span><span class="n">binned</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_subset</span><span class="p">)</span>
        <span class="k">return</span>

    </div>
<div class="viewcode-block" id="time_series.column_stats"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.column_stats">[docs]</a>    <span class="k">def</span> <span class="nf">column_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        takes statistics on a specific column of data</span>

<span class="sd">        creates object attributes according to the column name. for example:</span>

<span class="sd">        for col_header = &quot;temperature&quot;, the following attribute are created</span>

<span class="sd">        self.temperature_max_v      # maximum value</span>
<span class="sd">        self.temperature_min_v      # minimum value</span>
<span class="sd">        self.temperature_max_i      # index value where maximum occurs</span>
<span class="sd">        self.temperature_min_i      # index value where minimum occurs</span>
<span class="sd">        self.temperature_avg        # average</span>
<span class="sd">        self.temperature_std        # standard deviation</span>

<span class="sd">        :param col_header:      name of column on which to take statistics</span>
<span class="sd">        :return statistics:     a dictionary of the column statistical values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;calculating stats for time_series &#39;{0}&#39;, col &#39;{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">col_header</span><span class="p">))</span>

        <span class="c"># pull column data and find some stats</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>
        <span class="n">col_data</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">col_header</span><span class="p">])</span>

        <span class="c"># build array of stats</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">col_data</span><span class="p">),</span>
                 <span class="nb">min</span><span class="p">(</span><span class="n">col_data</span><span class="p">),</span>
                 <span class="n">col_data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">col_data</span><span class="p">)),</span>
                 <span class="n">col_data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">col_data</span><span class="p">)),</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col_data</span><span class="p">),</span>
                 <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">col_data</span><span class="p">)]</span>

        <span class="c"># build array of names</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;{0}_max_v&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">),</span>
                 <span class="s">&quot;{0}_min_v&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">),</span>
                 <span class="s">&quot;{0}_max_i&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">),</span>
                 <span class="s">&quot;{0}_min_i&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">),</span>
                 <span class="s">&quot;{0}_avg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">),</span>
                 <span class="s">&quot;{0}_std&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">)]</span>

        <span class="c"># set attributes for names and stats, also make dict for immediate return</span>
        <span class="n">statistics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">stat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stats</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">statistics</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">column_stats</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">statistics</span>

</div>
<div class="viewcode-block" id="time_series.subset_stats"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.subset_stats">[docs]</a>    <span class="k">def</span> <span class="nf">subset_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new time_series object, which is built from column statistics of this</span>
<span class="sd">        time_series&#39;s subsets. For example:</span>

<span class="sd">        Lets say we have a years worth of hourly temperature data, and we want to get</span>
<span class="sd">        daily summaries of temperature statistics. To do this, the syntax would look</span>
<span class="sd">        like this:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            temperature_ts.make_subsets(%d)</span>
<span class="sd">            daily_sum_ts = temperature_ts.subset_stats(&quot;Temp&quot;)</span>

<span class="sd">        This function is not yet finished.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;This function is unfinished&quot;</span><span class="p">)</span> <span class="c"># flag</span>
        <span class="k">return</span>
        
    
</div>
<div class="viewcode-block" id="time_series.column_plot"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.column_plot">[docs]</a>    <span class="k">def</span> <span class="nf">column_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_headers</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">save_path</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plots a specific column or column(s) by header name</span>

<span class="sd">        Accepts custom title input and y-axis label. If a save_path is</span>
<span class="sd">        specified, it will save the plot to that path and close it automatically.</span>

<span class="sd">        :param col_headers: list of columns to plot</span>
<span class="sd">        :param title:       title to place on plot</span>
<span class="sd">        :param xlabel:      label for x axis</span>
<span class="sd">        :param ylabel:      label for y axis</span>
<span class="sd">        :param save_path:   filepath at which to save figure as image.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># figure out temporal resolution of data to appropiately label x-axis</span>
        <span class="k">if</span>   <span class="bp">self</span><span class="o">.</span><span class="n">mean_interval</span> <span class="o">&gt;</span> <span class="mi">2592000</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;%Y %b&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_interval</span> <span class="o">&gt;</span> <span class="mi">86400</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;%Y %b </span><span class="si">%d</span><span class="s">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_interval</span> <span class="o">&gt;</span> <span class="mi">3600</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;%Y %b </span><span class="si">%d</span><span class="s"> %H&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_interval</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;%Y %b </span><span class="si">%d</span><span class="s"> %H:%M&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;%Y %b </span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_fmt</span> <span class="o">=</span> <span class="n">fmt</span>

        <span class="c"># set col_headers input to type &quot;list&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_headers</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">col_headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_headers</span><span class="p">]</span>

        <span class="c"># initialize plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">80</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">col_header</span> <span class="ow">in</span> <span class="n">col_headers</span><span class="p">:</span>

            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_stats</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">col_header</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">col_header</span><span class="p">)</span>
        
        <span class="c"># date formatting stuff</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fmt_xdata</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_fmt</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_fmt</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>

        <span class="c"># legend and titling</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

</div>
<div class="viewcode-block" id="time_series.normalize"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to normalize specific columns in the time series. Normalization</span>
<span class="sd">        will scale all value in the time series to be between 0 and 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># make sure data is cleaned for numerical formatting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>
        <span class="n">temp_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">col_header</span><span class="p">]</span>
        <span class="n">temp_col</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">temp_col</span><span class="p">)</span>

        <span class="c"># perform normalization</span>
        <span class="n">minval</span>   <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">temp_col</span><span class="p">)</span>
        <span class="n">maxval</span>   <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">temp_col</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxval</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;data in column &#39;{0}&#39; has been normalized!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>
        <span class="k">return</span>

</div>
<div class="viewcode-block" id="time_series.add_mono_time"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.add_mono_time">[docs]</a>    <span class="k">def</span> <span class="nf">add_mono_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a monotonically increasing time column with units of decimal days &quot;&quot;&quot;</span>

        <span class="c"># add an entry to every row item in row_data, then rebuild column data</span>
        <span class="k">if</span> <span class="s">&quot;decimal_days&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;decimal_days&quot;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_dec_days</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">build_col_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">add_mono_time</span><span class="p">()</span> 

        <span class="k">return</span> 

</div>
<div class="viewcode-block" id="time_series.interp_col"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.interp_col">[docs]</a>    <span class="k">def</span> <span class="nf">interp_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_obj</span><span class="p">,</span> <span class="n">col_header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For input column, interpolate values to estimate value at input time_obj.</span>
<span class="sd">        input time_obj may also be of datestring matching declared fmt.</span>

<span class="sd">        :param time_obj:    A datetime object</span>
<span class="sd">        :param col_header:  The name of the column to interpolate at time (time_obj)</span>

<span class="sd">        :return interp_y:   The interpolated value of input column at input time</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># start by cleaning data by input column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">col_header</span><span class="p">)</span>

        <span class="c"># x and y data for interpolation</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_data</span><span class="p">[</span><span class="n">col_header</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_seconds</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_obj</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">time_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">)</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="n">time_obj</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_dto</span>

        <span class="n">interp_x</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">interp_y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">interp_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Val in &#39;{0}&#39; at time &#39;{1}&#39; is &#39;{2}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col_header</span><span class="p">,</span> <span class="n">time_obj</span><span class="p">,</span> <span class="n">interp_y</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">interp_y</span>

        </div>
<div class="viewcode-block" id="time_series.interrogate"><a class="viewcode-back" href="../../../modules/tsa.html#dnppy.tsa.time_series.time_series.interrogate">[docs]</a>    <span class="k">def</span> <span class="nf">interrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; prints a heads up stats table of all subsets in this time_series &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disc_level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="o">*</span><span class="mi">84</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;time_series name </span><span class="se">\t\t</span><span class="s"> len </span><span class="se">\t</span><span class="s"> start </span><span class="se">\t\t\t</span><span class="s"> end&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="o">*</span><span class="mi">84</span><span class="p">)</span>

        <span class="c"># use leading and trailing spaces for visualizing subset depth</span>
        <span class="n">padded_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disc_level</span> <span class="o">*</span> <span class="s">&quot;   &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;{0} </span><span class="se">\t</span><span class="s"> {1} </span><span class="se">\t</span><span class="s"> {2} </span><span class="se">\t</span><span class="s"> {3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">padded_name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="s">&quot; &quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_dom</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsetted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">:</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">interrogate</span><span class="p">()</span>
        <span class="k">return</span>

            
<span class="c"># testing code</span></div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">filepath</span>    <span class="o">=</span> <span class="s">r&quot;test_data\weather_dat.txt&quot;</span>      <span class="c"># define filepath with text data</span>
    <span class="n">tdo</span>         <span class="o">=</span> <span class="n">textio</span><span class="o">.</span><span class="n">read_DS3505</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>      <span class="c"># build a &quot;text data object&quot; (tdo)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">tdo</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>                              <span class="c"># print the headers</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tdo</span><span class="o">.</span><span class="n">row_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                          <span class="c"># print the first row</span>

    <span class="n">ts</span> <span class="o">=</span> <span class="n">time_series</span><span class="p">(</span><span class="s">&#39;weather_data&#39;</span><span class="p">)</span>                <span class="c"># initialize a time series named &quot;weather_data&quot;</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">from_tdo</span><span class="p">(</span><span class="n">tdo</span><span class="p">)</span>                                <span class="c"># populate it with the contents of the tdo</span>

    <span class="k">print</span> <span class="n">ts</span><span class="o">.</span><span class="n">headers</span>                                <span class="c"># view the headers of this time series</span>

    <span class="n">timecol</span> <span class="o">=</span> <span class="s">&quot;YR--MODAHRMN&quot;</span>                        <span class="c"># identify the column with time information in it</span>
    <span class="n">fmt</span>     <span class="o">=</span> <span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">%H%M&quot;</span>                          <span class="c"># specify the format of strings in this column</span>
    
    <span class="n">ts</span><span class="o">.</span><span class="n">define_time</span><span class="p">(</span><span class="n">timecol</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>                    <span class="c"># converts text data into datetimes</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">interrogate</span><span class="p">()</span>                                 <span class="c"># print a heads up summary of the time series</span>
    
    <span class="n">ts</span><span class="o">.</span><span class="n">make_subsets</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>                           <span class="c"># subset the data into daily chunks, no overlap</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">interrogate</span><span class="p">()</span>                                 <span class="c"># print a heads up summary of the time series</span>

    <span class="n">ts</span><span class="o">.</span><span class="n">column_plot</span><span class="p">(</span><span class="s">&quot;TEMP&quot;</span><span class="p">)</span>                          <span class="c"># no frills plot of temperature</span>

    <span class="n">ts</span><span class="o">.</span><span class="n">rename_header</span><span class="p">(</span><span class="s">&quot;TEMP&quot;</span><span class="p">,</span><span class="s">&quot;Temperature&quot;</span><span class="p">)</span>          <span class="c"># give header more descriptive name</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">rename_header</span><span class="p">(</span><span class="s">&quot;DEWP&quot;</span><span class="p">,</span><span class="s">&quot;Dewpoint&quot;</span><span class="p">)</span>             <span class="c"># give header more descriptive name</span>
    
    <span class="n">jul21</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="s">&quot;2013-07-21&quot;</span><span class="p">]</span>                        <span class="c"># lets pull out the subset time_series for july 21st</span>
    
    <span class="n">jul21</span><span class="o">.</span><span class="n">column_plot</span><span class="p">([</span><span class="s">&quot;Temperature&quot;</span><span class="p">,</span><span class="s">&quot;Dewpoint&quot;</span><span class="p">],</span>   <span class="c"># Add a few nice labels to the plot</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Temperature and Dewpoint&quot;</span><span class="p">,</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s">&quot;Date and Time&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s">&quot;Degrees F&quot;</span><span class="p">)</span>

    <span class="n">ts</span><span class="o">.</span><span class="n">make_subsets</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">overlap_width</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>        <span class="c"># re-subset the time series with 1 day overlap width</span>
                    <span class="n">discard_old</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>             <span class="c">#   and discard the old subsets</span>
    
    <span class="n">ts</span><span class="o">.</span><span class="n">interrogate</span><span class="p">()</span>                                 <span class="c"># print a heads up summary</span>
    
    <span class="n">jul21</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="s">&quot;2013-07-21&quot;</span><span class="p">]</span>                        <span class="c"># pull out the new july 21st subset</span>
    <span class="n">jul21</span><span class="o">.</span><span class="n">column_plot</span><span class="p">([</span><span class="s">&quot;Temperature&quot;</span><span class="p">,</span><span class="s">&quot;Dewpoint&quot;</span><span class="p">],</span>   <span class="c"># plot the data again, save it this time</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Temperature and Dewpoint&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s">&quot;Degrees F&quot;</span><span class="p">,</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="s">&quot;test.png&quot;</span><span class="p">)</span>
    
    <span class="n">ts</span><span class="o">.</span><span class="n">add_mono_time</span><span class="p">()</span>                              <span class="c"># add monotonically increasing time value to each row</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">r&quot;test_data\weather_csv.txt&quot;</span><span class="p">)</span>         <span class="c"># save this time_series dataset to a CSV.</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="s">r&quot;test_data\weather_csv.txt&quot;</span><span class="p">)</span>       <span class="c"># reload this time_series from a CSV. note that the time</span>
                                                    <span class="c">#   series must be re-subsetted as before, this information</span>
                                                    <span class="c">#   was not preserved.</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.15.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>